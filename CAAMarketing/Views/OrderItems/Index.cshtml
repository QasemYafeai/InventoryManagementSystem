@model IEnumerable<CAAMarketing.Models.Receiving>

@{
    ViewData["Title"] = "Index";
    CAAMarketing.Models.Item item = (CAAMarketing.Models.Item)ViewBag.Item;
}


<div class="detext-orderitem">
    <center>
       @* <div class="tooltip" style="float:left;"> <a asp-action="Index"> <img src="~/images/icons8-go-back-24.png" alt="Back Icon" /> <span class="tooltiptext">Back</span></a> </div>*@
        @*Note: Instead of figure, you can also use Cards for this layout
        https://getbootstrap.com/docs/5.0/components/card/#horizontal*@
        <figcaption class="col mt-3 deth1top"><h1><text class="d-none d-sm-inline"></text>@item.Name</h1></figcaption>
    </center>

    <style>
        h1, .tooltip {
            display: inline-block;
            margin-left:-20px;
            vertical-align: middle;
        }
    </style>

    <div class="row" style="margin:50px 0">
        <div class="col-3">
            @{
                if (item.ItemImages?.Content != null)
                {
                    string imageBase64 = Convert.ToBase64String(item.ItemImages.Content);
                    string imageSrc = string.Format("data:" + item.ItemImages.MimeType + ";base64,{0}", imageBase64);
                    <div class="item-image">
                        <img src="@imageSrc" alt="Profile Picture of @item.Name" title="Item Picture of @item.Name" class="img-fluid rounded" />
                    </div>
                }
                else
                {
                    <div class="item-image">
                        <img src="~/images/image-not-found .png" class="img-fluid rounded" />
                    </div>
                }
                <div id="barcode-container" style="display: none;">
                    @Html.Raw(ViewBag.BarcodeImage)
                    <button class="print-button" id="print-btn" onclick="printBarcode()">Print Barcode</button>
                </div>
            }

        </div>
        <div class="col-4 dettop">
            <dl class="row">
                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Name):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Name)
                </dd>
                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Description):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Description)
                </dd>

                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Category):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Category.Name)
                </dd>
                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.UPC):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.UPC)
                </dd>

                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Cost):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Cost)
                </dd>

                <dt class="col-sm-5">
                    Total Stock:
                </dt>
                <dd class="col-sm-7">
                    @{
                        int TotalStock = 0;
                    }
                    @{
                        if (item.Inventories.Count() == 0)
                        {
                            <p>None</p>
                        }
                        else
                        {


                            @foreach (var c in item.Inventories)
                            {
                                TotalStock += c.Quantity;
                            }
                            @TotalStock
                        }

                    }

                </dd>

            </dl>
        </div>
        <div class="col-5 dettop">
            <dl class="row">

                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.DateReceived):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.DateReceived)
                </dd>
                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Supplier):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Supplier.Name)
                </dd>
                <dt class="col-sm-5">
                    Employee:
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Employee.FullName)
                </dd>
                <dt class="col-sm-5">
                    Last Modified By:
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.EmployeeNameUser)
                </dd>
                <dt class="col-md-5">
                    @Html.DisplayNameFor(model => item.Archived)?
                </dt>
                <dd class="col-md-7">
                    @{
                        if (item.Archived == true)
                        {
                            @:Yes
                        }
                        else
                        {
                            @:No
                        }
                    }
                </dd>
                <dt class="col-sm-5">
                    Item Low Threshold:
                </dt>
                <dd class="col-sm-7">

                    <a asp-action="Edit" title="Click this to edit" asp-controller="Categories" asp-route-id="@item.CategoryID" class="padding-for-actions div-back">@Html.DisplayFor(model => item.Category.LowCategoryThreshold) </a>
                </dd>
                <dt class="col-sm-5">
                    @Html.DisplayNameFor(model => item.Notes):
                </dt>
                <dd class="col-sm-7">
                    @Html.DisplayFor(model => item.Notes)
                </dd>

            </dl>

        </div>
        <div class="detlin">
            @*for full audit*@
            <div>
                <dl class="row">
                    <dt class="col-md-5">
                        <a id="audithistory" href="">
                            Audit History
                        </a>
                    </dt>
                    <dd class="col-md-10">
                        <div id="AuditForm">
                        </div>
                    </dd>
                </dl>
            </div>

            <a href="@Url.Action("Create", "InventoryTransfers", new { itemId = @item.ID })" title="Click this to transfer the item" class="btn-transfer">Transfer</a>
            <a id="toggle-barcode" class="btn-transfer">
                Show Barcode
            </a>
            <a href="@Url.Action("AddItemReservation", "OrderItems", new { itemId = @item.ID })" title="Click this to book the item" class="btn-transfer">Book Item</a>
            <div class="detbut">
                <a asp-action="Edit" title="Click this to edit" asp-controller="Items" asp-route-id="@item.ID" class=" link-action">Edit </a> |
                <a href='@ViewData["returnURL"]' title="Click this to go to the Inventory List" class="link-action">Back to Inventory List</a>
            </div>
            <br />
            <br />
           
        </div>
    </div>
</div>

@*for full audit*@
@section Scripts {
    <script type="text/javascript">
        //$(document).on("click", "#audithistory", function () {
        //    event.preventDefault();
        //    $('#AuditForm').load('/Items/ItemAuditHistory/' + @item.ID);
        //});

        var isAuditFormVisible = false;

        $(document).on("click", "#audithistory", function (event) {
            event.preventDefault();
            if (isAuditFormVisible) {
                $('#AuditForm').empty();
                isAuditFormVisible = false;
            } else {
                $('#AuditForm').load('/Items/ItemAuditHistory/' + @item.ID, function () {
                    isAuditFormVisible = true;
                });
            }
        });

        $(document).on("click", function (event) {
            if (!$(event.target).closest('#AuditForm').length && !$(event.target).is('#audithistory')) {
                $('#AuditForm').empty();
                isAuditFormVisible = false;
            }
        });
    </script>
}


<br />
<button id="show-tables-btn" class="btn-show-info" style="display: block; margin: 0 auto;" title="Click to show/hide information">
    Show more information <i class="fa fa-chevron-down"></i>
</button>

<div id="more-info-container" style="display: none;">



    <div class="container">
        <fieldset style="border: 2px solid #D3D3D3; padding: 5px; margin-top:10px">
        @*FOR THE LOCATIONS VIEW*@
        <div class="form-horizontal">
                    <div class="container-fluid">
                        <div class="table-responsive">
                            <div class="table-wrapper" ">
                                    <div class="table-title d-flex justify-content-between align-items-center">
                                        <h2>Locations</h2>
                                    </div>
                                    <table class="table table-hover">
                                        <colgroup>
                                            <col span="1" />
                                            <col span="1" />
                                            <col span="1" />
                                        </colgroup>
                                        <tr>
                                            <th>
                                                <input type="submit" name="actionButton" value="Location" class="btn btn-link" />
                                            </th>
                                            <th>
                                                <input type="submit" name="actionButton" value="Address" class="btn btn-link" />
                                            </th>
                                            <th>
                                                <input type="submit" name="actionButton" value="Phone Number" class="btn btn-link" />
                                                @* @Html.DisplayNameFor(model => model.Cost)*@
                                            </th>
                                            <th>
                                                <input type="submit" name="actionButton" value="Quantity" class="btn btn-link" />
                                                @* @Html.DisplayNameFor(model => model.Cost)*@
                                            </th>

                                        </tr>

                                        @foreach (var itemlocations in item.Inventories)
                                        {
                                            <tr>
                                                <td>
                                                    @Html.DisplayFor(modelItem => itemlocations.Location.Name)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => itemlocations.Location.Address)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => itemlocations.Location.Phone)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => itemlocations.Quantity)
                                                </td>

                                            </tr>
                                        }
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </table>
                            </div>
                        </div>
                    </div>
        </div>

    </fieldset>

                @*FOR THE ORDER RECIEVING TABLE*@

            <fieldset style="border: 2px solid #D3D3D3; padding: 5px; margin-top:10px">
                <form asp-action="Index" method="get">
                    <input type="hidden" name="sortDirection" value="@ViewData["sortDirection"]" />
                    <input type="hidden" name="sortField" value="@ViewData["sortField"]" />
                    <input type="hidden" name="ItemID" value="@item.ID" />
                    <div class="form-horizontal">
                        <div class="form-horizontal">
                            <div>

                                <div class="container-fluid">
                                    <div class="table-responsive">
                                        <div class="table-wrapper">
                                            <div class="table-title d-flex justify-content-between align-items-center">
                                                <h2>Receiving</h2>
                                                <div class="col-xs-7">
                                                    @*<a asp-action="Create" title="Click this to create new receive" class="btn btn-primary">
                                                    <i class="material-icons">&#xE147;</i>
                                                    <span>Create a Receive</span>
                                                    </a>*@
                                                </div>
                                            </div>
                                            <table class="table table-hover">
                                                <colgroup>
                                                    <col span="1" />
                                                    <col span="1" />
                                                    <col span="1" />
                                                    <col span="1" width="200" />
                                                    <col span="1" />
                                                </colgroup>
                                                <tr>
                                                    @*<th>
                                                        <input type="submit" name="actionButton" value="UPC" class="btn btn-link" />
                                                    </th>*@
                                                    <th>
                                                        <input type="submit" name="actionButton" value="Quantity" class="btn btn-link" />
                                                    </th>
@*                                                        <th>
                                                        <input type="submit" name="actionButton" value="Cost" class="btn btn-link" />
                                                            @Html.DisplayNameFor(model => model.Cost)
                                                    </th>*@
@*                                                        <th>
                                                        <input type="submit" name="actionButton" value="DateMade" class="btn btn-link" />
                                                    </th>*@
                                                    <th>
                                                        <input type="submit" name="actionButton" value="DeliveryDate" class="btn btn-link" />
                                                    </th>
                                                    <th>
                                                        <input type="submit" name="actionButton" value="Location" class="btn btn-link" />
                                                    </th>
                                                    <th class="text-center">
                                                        Received
                                                    </th>
                                                    @{
                                                        if (User.IsInRole("Admin"))
                                                        { 
                                                        <th class="text-center">
                                                            <a onclick="window.location.href='@Url.Action("Add", "OrderItems", new { ItemID = item.ID })'">
                                                                <span class="btn btn-success buth" data-bs-toggle="tooltip"title="Add a receive"><strong>&#x271A; Add</strong></span>
                                                            </a>
                                                        </th>
                                                        }
                                                    }

                                                </tr>

                                                @foreach (var order in Model)
                                                {
                                                    <tr>
                                                        @*<td>
                                                            @Html.DisplayFor(modelItem => order.Item.UPC)
                                                        </td>*@
                                                        <td>
                                                            @Html.DisplayFor(modelItem => order.Quantity)
                                                        </td>
@*                                                            <td>
                                                            @Html.DisplayFor(modelItem => order.Cost)
                                                        </td>*@
@*                                                            <td>
                                                            @Html.DisplayFor(modelItem => order.DateMade)
                                                        </td>*@

                                                        <td>
                                                            @Html.DisplayFor(modelItem => order.DeliveryDate)
                                                        </td>
                                                        <td>
                                                            @Html.DisplayFor(modelItem => order.Location.Name)
                                                        </td>
                                                        <td>
                                                            @{
                                                                DateTime deliveryDate = Convert.ToDateTime(order.DeliveryDate);
                                                                TimeSpan timeRemaining = deliveryDate - DateTime.Now;

                                                                int totalDaysRemaining = (int)timeRemaining.TotalDays;
                                                                int totalWeeksRemaining = (int)timeRemaining.TotalDays / 7;
                                                                int totalMonthsRemaining = (int)timeRemaining.TotalDays / 30;
                                                                int totalYearsRemaining = (int)timeRemaining.TotalDays / 365;
                                                                int totalHoursRemaining = (int)timeRemaining.TotalHours;
                                                                int totalMinutesRemaining = (int)timeRemaining.TotalMinutes;
                                                                int totalSecondsRemaining = (int)timeRemaining.TotalSeconds;

                                                                var progress = 100 - Math.Min(Math.Max(totalDaysRemaining, 0), 100);

                                                                string remainingTime = string.Empty;

                                                                if (totalYearsRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalYearsRemaining} year{(totalYearsRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalMonthsRemaining % 12 > 0)
                                                                    {
                                                                        remainingTime += $", {totalMonthsRemaining % 12} month{(totalMonthsRemaining % 12 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                                else if (totalMonthsRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalMonthsRemaining} month{(totalMonthsRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalDaysRemaining % 30 > 0)
                                                                    {
                                                                        remainingTime += $", {totalDaysRemaining % 30} day{(totalDaysRemaining % 30 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                                else if (totalWeeksRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalWeeksRemaining} week{(totalWeeksRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalDaysRemaining % 7 > 0)
                                                                    {
                                                                        remainingTime += $", {totalDaysRemaining % 7} day{(totalDaysRemaining % 7 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                                else if (totalDaysRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalDaysRemaining} day{(totalDaysRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalHoursRemaining % 24 > 0)
                                                                    {
                                                                        remainingTime += $", {totalHoursRemaining % 24} hour{(totalHoursRemaining % 24 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                                else if (totalHoursRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalHoursRemaining} hour{(totalHoursRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalMinutesRemaining % 60 > 0)
                                                                    {
                                                                        remainingTime += $", {totalMinutesRemaining % 60} minute{(totalMinutesRemaining % 60 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                                else if (totalMinutesRemaining > 0)
                                                                {
                                                                    remainingTime = $"{totalMinutesRemaining} minute{(totalMinutesRemaining > 1 ? "s" : string.Empty)}";
                                                                    if (totalSecondsRemaining % 60 > 0)
                                                                    {
                                                                        remainingTime += $", {totalSecondsRemaining % 60} second{(totalSecondsRemaining % 60 > 1 ? "s" : string.Empty)}";
                                                                    }
                                                                }
                                                            }

                                                            <div class="progress">
                                                                <div class="progress-bar @((deliveryDate > DateTime.Now) ? "bg-warning" : "bg-success")"
                                                                    role="progressbar"
                                                                    aria-valuenow="@progress"
                                                                    aria-valuemin="0"
                                                                    aria-valuemax="100"
                                                                    style="width: @progress%;">
                                                                    @if (deliveryDate > DateTime.Now)
                                                                    {
                                                                        @($"In Progress ({remainingTime} remaining)")
                                                                    }
                                                                    else
                                                                    {
                                                                        <span class="text-white">Received</span>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </td>
                                                <td class="text-center">
                                    @{
                                        if (User.IsInRole("Admin"))
                                        {
                                                                <a onclick="window.location.href='@Url.Action("Details", "Receiving", new { id = @order.ID })'">
                                                                    <span class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View receive details">&#x1F441;</span>
                                                                </a>

                                                                <a onclick="window.location.href='@Url.Action("Update", "OrderItems", new { id = @order.ID })'">
                                                                    <span class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="Edit a receive">&#x270D;</span>
                                                                </a>

                                            if (order.DeliveryDate < DateTime.Now)
                                            {
                                                                    <a onclick="window.location.href='@Url.Action("Remove", "OrderItems", new { id = @order.ID })'">
                                                                        <span class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip" title="Delete a receive">&#x274C;</span>
                                                                    </a>
                                            }
                                        }
    
                                    }

                                                        </td>
                                                    </tr>
                                                }
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </form>
            </fieldset>








    @*<div style="margin-top:3px"></div>*@
    





    @*FOR THE Item Transfers TABLE*@

    <fieldset style="border: 2px solid #D3D3D3; padding: 5px;">
        <div class="form-horizontal">
            <div class="form-horizontal">
                <div>

                    <div class="container-fluid">
                        <div class="table-responsive">
                            <div class="table-wrapper">
                                <div class="table-title d-flex justify-content-between align-items-center">
                                    <h2>Transfers Log</h2>
                                    <div class="col-xs-7">
                                    </div>
                                </div>
                                <table class="table table-hover">
                                    <colgroup>
                                        <col span="1" />
                                        <col span="1" />
                                        <col span="1" />
                                        <col span="1" />
                                        <col span="1" width="400" />
                                        <col span="1" />
                                    </colgroup>
                                    <tr>
@*                                        <th>
                                            <input type="submit" name="actionButton" value="Item" class="btn btn-link" />
                                        </th>*@
                                        <th>
                                            <input type="submit" name="actionButton" value="From" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="To" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Quantity" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="TransferDate" class="btn btn-link" />
                                        </th>
                                        <th class="text-center">
                                            Transfered
                                        </th>
                                        <th>
                                            Actions
                                        </th>

                                    </tr>
                                    @if (item.InventoryTransfers != null)
                                    {
                                        @foreach (var itemTransfers in item.InventoryTransfers)
                                        {
                                            <tr>
                                               @* <td>@Html.DisplayFor(modelItem => itemTransfers.Item.Name)</td>*@
                                                <td>@Html.DisplayFor(modelItem => itemTransfers.FromLocation.Name)</td>
                                                <td>@Html.DisplayFor(modelItem => itemTransfers.ToLocation.Name)</td>
                                                <td>@Html.DisplayFor(modelItem => itemTransfers.Quantity)</td>
                                                <td>@Html.DisplayFor(modelItem => itemTransfers.TransferDate)</td>

                                                <td>
                                                    @{
                                                        DateTime deliveryDate = Convert.ToDateTime(itemTransfers.TransferDate);
                                                        TimeSpan timeRemaining = deliveryDate - DateTime.Now;

                                                        int totalDaysRemaining = (int)timeRemaining.TotalDays;
                                                        int totalWeeksRemaining = (int)timeRemaining.TotalDays / 7;
                                                        int totalMonthsRemaining = (int)timeRemaining.TotalDays / 30;
                                                        int totalYearsRemaining = (int)timeRemaining.TotalDays / 365;
                                                        int totalHoursRemaining = (int)timeRemaining.TotalHours;
                                                        int totalMinutesRemaining = (int)timeRemaining.TotalMinutes;
                                                        int totalSecondsRemaining = (int)timeRemaining.TotalSeconds;

                                                        var progress = 100 - Math.Min(Math.Max(totalDaysRemaining, 0), 100);

                                                        string remainingTime = string.Empty;

                                                        if (totalYearsRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalYearsRemaining} year{(totalYearsRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalMonthsRemaining % 12 > 0)
                                                            {
                                                                remainingTime += $", {totalMonthsRemaining % 12} month{(totalMonthsRemaining % 12 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                        else if (totalMonthsRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalMonthsRemaining} month{(totalMonthsRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalDaysRemaining % 30 > 0)
                                                            {
                                                                remainingTime += $", {totalDaysRemaining % 30} day{(totalDaysRemaining % 30 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                        else if (totalWeeksRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalWeeksRemaining} week{(totalWeeksRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalDaysRemaining % 7 > 0)
                                                            {
                                                                remainingTime += $", {totalDaysRemaining % 7} day{(totalDaysRemaining % 7 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                        else if (totalDaysRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalDaysRemaining} day{(totalDaysRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalHoursRemaining % 24 > 0)
                                                            {
                                                                remainingTime += $", {totalHoursRemaining % 24} hour{(totalHoursRemaining % 24 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                        else if (totalHoursRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalHoursRemaining} hour{(totalHoursRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalMinutesRemaining % 60 > 0)
                                                            {
                                                                remainingTime += $", {totalMinutesRemaining % 60} minute{(totalMinutesRemaining % 60 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                        else if (totalMinutesRemaining > 0)
                                                        {
                                                            remainingTime = $"{totalMinutesRemaining} minute{(totalMinutesRemaining > 1 ? "s" : string.Empty)}";
                                                            if (totalSecondsRemaining % 60 > 0)
                                                            {
                                                                remainingTime += $", {totalSecondsRemaining % 60} second{(totalSecondsRemaining % 60 > 1 ? "s" : string.Empty)}";
                                                            }
                                                        }
                                                    }

                                                    <div class="progress">
                                                        <div class="progress-bar @((!itemTransfers.IsComfirmed) ? "bg-warning" : ((deliveryDate > DateTime.Now) ? "bg-warning" : "bg-success"))"
                                                     role="progressbar"
                                                     aria-valuenow="@progress"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"
                                                     style="width: @progress%;">
                                                            @if (!itemTransfers.IsComfirmed)
                                                            {
                                                                @("Received (Not Comfirmed Yet)")
                                                            }
                                                            else if (deliveryDate > DateTime.Now)
                                                            {
                                                                @($"In Progress ({remainingTime} remaining)")
                                                            }
                                                            else
                                                            {
                                                                <span class="text-white">Received</span>
                                                            }
                                                        </div>
                                                    </div>



                                                </td>

                                                <td>

                                                    @{
                                                        if (!itemTransfers.IsComfirmed)
                                                        {
                                                            <a onclick="window.location.href='@Url.Action("ComfirmMultiple", "InventoryTransfers", new { id = @itemTransfers.TransferId })'" asp-action="ComfirmMultiple" asp-controller="InventoryTransfers" title="Click this to log back in the items" class="padding-for-actions" asp-route-id="@itemTransfers.TransferId">Comfirm Transit | </a>
                                                        }
                                                        <a onclick="window.location.href='@Url.Action("EditOverview", "InventoryTransfers", new { id = @itemTransfers.TransferId })'" asp-action="EditOverview" asp-controller="InventoryTransfers" title="Click this to log back in the items" class="padding-for-actions" asp-route-id="@itemTransfers.TransferId">Details</a>
                                                        <br />
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    }
                                    
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <partial name="_PagingNavBar" />
    </fieldset>



    @*FOR THE Item Transfers TABLE*@

    <fieldset style="border: 2px solid #D3D3D3; padding: 5px;">
        <div class="form-horizontal">
            <div class="form-horizontal">
                <div>

                    <div class="container-fluid">
                        <div class="table-responsive">
                            <div class="table-wrapper">
                                <div class="table-title d-flex justify-content-between align-items-center">
                                    <h2>Reservations Log</h2>
                                    <div class="col-xs-7">
                                    </div>
                                </div>
                                <table class="table table-hover">
                                    <colgroup>
                                        <col span="1" />
                                        <col span="1" />
                                        <col span="1" width="400" />
                                        <col span="1" />
                                    </colgroup>
                                    <tr>
                                        <th>
                                            <input type="submit" name="actionButton" value="Event" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Quantity" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Location" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Reserved Date" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Return Date" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="submit" name="actionButton" value="Logged" class="btn btn-link" />
                                        </th>
                                        <th>
                                            <input type="button" disabled="disabled" name="actionButton" value="Actions" class="btn btn-link" />
                                        </th>
@*                                        <th>
                                            <a asp-controller="OrderItems" asp-action="AddItemReservation" asp-route-ItemID="@item.ID"
                                               asp-route-ItemName="@item.Name">
                                                <span class="btn btn-success buth" data-bs-toggle="tooltip"
                                                      title="Add a Reservation"><strong>&#x271A; Book Item For Event</strong></span>
                                            </a>
                                        </th>*@

                                    </tr>
                                    @if (item.ItemReservations != null)
                                    {
                                        @foreach (var reservation in item.ItemReservations)
                                        {
                                            <tr>
                                                <td>@Html.DisplayFor(modelItem => reservation.Event.Name)</td>
                                                <td>@Html.DisplayFor(modelItem => reservation.Quantity)</td>
                                                <td>@Html.DisplayFor(modelItem => reservation.Location.Name)</td>
                                                <td>@Html.DisplayFor(modelItem => reservation.Event.ReservedEventDate)</td>
                                                <td>@Html.DisplayFor(modelItem => reservation.Event.ReturnEventDate)</td>
                                                <td>
                                                    @{
                                                        @if (reservation.IsLoggedIn)
                                                        {
                                                        <span style="color: green;">&#10003;</span>

                                                        }
                                                        else
                                                        {
                                                        <span style="color: red;">&#10007;</span>
                                                        }
                                                        <br />
                                                    }
                                                </td>
                                                    
                                                
                                                
                                                <td>
                                                    
                                                    @if (!reservation.IsLoggedIn && reservation.Event.ReturnEventDate <= DateTime.Today)
                                                    {
                                                        <a onclick="window.location.href='@Url.Action("LogBackInMultiple", "Events", new { id = @reservation.EventId })'" asp-action="LogBackInMultiple" asp-controller="Events" title="Click this to log back in the items" class="padding-for-actions" asp-route-id="@reservation.EventId">Log-Back-in | </a>
                                                    }
                                                <a onclick="window.location.href='@Url.Action("EditOverview", "Events", new { id = @reservation.EventId })'" asp-action="EditOverview" asp-controller="Events" title="Click this to log back in the items" class="padding-for-actions" asp-route-id="@reservation.EventId">Details</a>
                                                </td>

                                                @*                                                
                                                    <td>
                                                    <a asp-controller="Events" asp-action="LogBackInMultiple" asp-route-id="@reservation.EventId"> Log Back In </a>
                                                    </td>
                                                *@

                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="7">No Reservations found.</td>
                                        </tr>
                                    }


                                    <tr>

                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <partial name="_PagingNavBar" />
    </fieldset>
</div>
<script>
    $(document).ready(function () {
        $("#toggle-barcode").on("click", function () {
            $("#barcode-container").slideToggle("slow", function () {
                var btnText = $("#barcode-container").is(":visible") ? "Hide Barcode" : "Show Barcode";
                $("#toggle-barcode").text(btnText);
            });
        });
    });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#show-tables-btn").on("click", function () {
            $("#more-info-container").slideToggle("slow", function () {
                var btnText = $("#more-info-container").is(":visible") ? "Hide more information" : "Show more information";
                var iconClass = $("#more-info-container").is(":visible") ? "fa fa-chevron-up" : "fa fa-chevron-down";
                $("#show-tables-btn").html(btnText + ' <i class="' + iconClass + '"></i>');
            });
        });
    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

<script>
    function printBarcode() {
        var htmlContent = '<div class="barcode-container">' + document.getElementById("barcode-container").innerHTML + '</div>';
        var printWindow = window.open('', '_blank');
        printWindow.document.write('<html><head><title>Print Barcode</title>');
        printWindow.document.write('<style>body {font-size: 0; margin: 0;} .barcode-container {text-align: center; width: 350px; margin: auto;} img {width: 100%;} .print-button {display: none;} @@media print { @@page { margin: 0; size: auto; } }</style>');
        printWindow.document.write('</head><body>');
        printWindow.document.write(htmlContent);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        setTimeout(function () {
            printWindow.print();
        }, 400);
    }
</script>


<style>
    .table-wrapper {
        overflow-y: auto;
        max-height: 400px; /* set max height here */
    }

    a {
        cursor: pointer;
    }

</style>